import { Meta } from "@storybook/addon-docs/blocks"

<Meta title="Docs/Configuration" />

# Configuration

The `ChartsConfig` interface allows you to customize branding, data sources, error handling, and analytics.

## ChartsConfig Interface

```typescript
interface ChartsConfig {
  branding?: ChartsBranding
  dataApi: ChartsDataApi
  errorReporting?: ChartsErrorReporting
  analytics?: ChartsAnalytics
}
```

## Branding

Customize the appearance and attribution of your charts:

```typescript
interface ChartsBranding {
  // License text displayed in chart footer (default: "CC BY")
  licenseText?: string

  // URL for license link
  licenseUrl?: string

  // "Powered by" attribution text
  poweredByText?: string

  // URL for "Powered by" link
  poweredByUrl?: string

  // Support email for error messages
  supportEmail?: string

  // Custom tooltip for license section
  licenseTooltip?: string

  // Custom logos
  logos?: Record<string, LogoConfig>
}
```

### Example

```tsx
const config = {
  branding: {
    poweredByText: "Acme Analytics",
    poweredByUrl: "https://acme.com",
    licenseText: "CC BY 4.0",
    licenseUrl: "https://creativecommons.org/licenses/by/4.0/",
    supportEmail: "support@acme.com",
  },
  dataApi: { baseUrl: "https://api.acme.com/data/" },
}
```

## Data API

Configure where chart data is fetched from:

```typescript
interface ChartsDataApi {
  // Base URL for data API
  baseUrl: string

  // Custom route for variable data (optional)
  getVariableDataRoute?: (variableId: number) => string

  // Custom route for variable metadata (optional)
  getVariableMetadataRoute?: (variableId: number) => string
}
```

### Default Routes

By default, the library fetches data from:
- Data: `${baseUrl}/${variableId}.data.json`
- Metadata: `${baseUrl}/${variableId}.metadata.json`

### Custom Routes

```tsx
const config = {
  dataApi: {
    baseUrl: "https://api.example.com",
    getVariableDataRoute: (id) => `/v2/variables/${id}/values`,
    getVariableMetadataRoute: (id) => `/v2/variables/${id}/meta`,
  },
}
```

## Error Reporting

Integrate with your error tracking service:

```typescript
interface ChartsErrorReporting {
  enabled: boolean
  handler?: (error: Error, context: Record<string, unknown>) => void
}
```

### Example with Sentry

```tsx
import * as Sentry from "@sentry/react"

const config = {
  dataApi: { baseUrl: "..." },
  errorReporting: {
    enabled: true,
    handler: (error, context) => {
      Sentry.captureException(error, { extra: context })
    },
  },
}
```

## Analytics

Track user interactions with charts:

```typescript
interface ChartsAnalytics {
  enabled: boolean
  trackEvent?: (eventName: string, properties: Record<string, unknown>) => void
}
```

### Example with Custom Analytics

```tsx
const config = {
  dataApi: { baseUrl: "..." },
  analytics: {
    enabled: true,
    trackEvent: (event, props) => {
      // Send to your analytics service
      myAnalytics.track(event, props)
    },
  },
}
```

## Custom Logos

Add custom logos to display in charts:

```typescript
interface LogoConfig {
  svg: string      // SVG markup as string
  width: number    // Logo width in pixels
  height: number   // Logo height in pixels
  url?: string     // Optional link URL
}
```

### Example

```tsx
const config = {
  branding: {
    logos: {
      primary: {
        svg: `<svg>...</svg>`,
        width: 120,
        height: 40,
        url: "https://example.com",
      },
    },
  },
  dataApi: { baseUrl: "..." },
}
```

## Full Example

```tsx
import { ChartsProvider } from "@buildcanada/charts"

const config = {
  branding: {
    poweredByText: "Build Canada",
    poweredByUrl: "https://buildcanada.ca",
    licenseText: "CC BY 4.0",
    licenseUrl: "https://creativecommons.org/licenses/by/4.0/",
    supportEmail: "data@buildcanada.ca",
  },
  dataApi: {
    baseUrl: "https://api.buildcanada.ca/v1/indicators/",
  },
  errorReporting: {
    enabled: process.env.NODE_ENV === "production",
    handler: (error, context) => console.error(error, context),
  },
  analytics: {
    enabled: true,
    trackEvent: (event, props) => {
      window.gtag?.("event", event, props)
    },
  },
}

function App() {
  return (
    <ChartsProvider config={config}>
      {/* Your application */}
    </ChartsProvider>
  )
}
```
